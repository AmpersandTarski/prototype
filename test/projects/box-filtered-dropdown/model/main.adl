CONTEXT FilteredDropDownTests

REPRESENT Name TYPE ALPHANUMERIC
REPRESENT Location TYPE ALPHANUMERIC
REPRESENT Datum TYPE DATE
REPRESENT Integer TYPE INTEGER

RELATION name[Employee*Name] [UNI]
RELATION eligible[Project*Employee]
RELATION instroomVanaf[Project*Datum] [UNI]
RELATION instroomOpties[Project*Datum]
RELATION aantal[Project*Integer] [UNI]
RELATION keuze[Project*Integer]
RELATION projectMember[Project*Employee]
RELATION projectMaster[Project*Employee] [UNI]
RELATION projectFounder[Project*Employee] [TOT]
RELATION projectResponsible[Project*Employee] [UNI,TOT]
RELATION projectLocation[Project*Location]

POPULATION name[Employee*Name] CONTAINS
  [ ("m1", "Jan Jansen")
  , ("m2", "Piet Peters")
  , ("m3", "Marie Bakker")
  , ("m4", "Klaas Klaasen")
  , ("m5", "Anna Annasson")
  , ("m6", "Berent Boudewijn")
  ]

-- Desired filtering: eligible employees only
POPULATION eligible[Project*Employee] CONTAINS
  [ ("project 1", "m1")
  , ("project 1", "m4")
  , ("project 1", "m5")
  , ("project 2", "m3")
  , ("project 2", "m5")
  , ("project 3", "m5")
  ]

POPULATION instroomVanaf[Project*Datum] CONTAINS -- UNI
  [ ("project 2", 2025-10-01)
  , ("project 3", 2025-12-20)
  ]

POPULATION instroomOpties[Project*Datum] CONTAINS
  [ ("project 1", 2025-10-01)
  , ("project 1", 2026-04-12)
  , ("project 1", 2026-01-03)
  , ("project 1", 2025-11-15)
  , ("project 2", 2025-11-01)
  , ("project 2", 2026-04-12)
  , ("project 2", 2025-01-04)
  , ("project 3", 2025-12-20)
  ]

POPULATION aantal[Project*Integer] CONTAINS
  [ ("project 1", 1)
  , ("project 2", 11)
  , ("project 3", 8)
  ]

POPULATION keuze[Project*Integer] CONTAINS
  [ ("project 1", 1)
  , ("project 1", 3)
  , ("project 1", 5)
  , ("project 1", 7)
  , ("project 2", 11)
  , ("project 3", 8)
  , ("project 3", 16)
  , ("project 3", 24)
  ]

POPULATION projectMember[Project*Employee] CONTAINS
  [ ("project 1", "m1")
  , ("project 1", "m2")
  , ("project 1", "m4")
  , ("project 1", "m5")
  , ("project 4", "m6")
  ]

POPULATION projectMaster[Project*Employee] CONTAINS --UNI
  [ ("project 1", "m3")
  ]

POPULATION projectFounder[Project*Employee] CONTAINS -- TOT
  [ ("project 1", "m1")
  , ("project 2", "m5")
  , ("project 3", "m5")
  , ("project 4", "m6")
  ]

POPULATION projectResponsible[Project*Employee] CONTAINS -- UNI,TOT
  [ ("project 1", "m3") 
  , ("project 2", "m5")
  , ("project 3", "m5")
  , ("project 4", "m6") -- m6 is not eligible at all
  ]

-- Intentionally created a separate relation of a different type for the error page
POPULATION projectLocation[Project*Location] CONTAINS
  [ ("project 1", "Amsterdam")
  , ("project 1", "Rotterdam")
  ]

-- Dedicated page to preview data
INTERFACE DropdownDataInForm LABEL "Dropdown data in Form" : "_SESSION"[SESSION] cRud BOX<TABS>
  [ "Table Preview" : V[SESSION*Project] cRud BOX<Table>
      [ "Project ID" : I cRud
      , selectFromPreview : eligible cRud   
      , projectMember : projectMember cRud  
      , "projectMaster(UNI)" : projectMaster cRud
      , "projectFounder(TOT)" : projectFounder cRud
      , "projectResponsible(UNI,TOT)" : projectResponsible cRud
      , "ProjectLocation" : projectLocation cRud
      ]
  ]

INTERFACE BoxFilteredDropdownTests LABEL "Box-Filtered-Dropdown tests" : "_SESSION"[SESSION] cRud BOX<TABS>
  [ "Default": V[SESSION*Project] cRud BOX<FORM>
      [ "Project ID" : I cRud
      , setRelationPreview : projectMember cRud  -- preview projectMember for testing purposes
      , selectFromPreview : eligible cRud        -- preview the selection for testing purposes

      , "1. Assign an employee (cRud)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember cRud
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf cRud
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal cRud
             ]
          ]
      , "2. Assign an employee (cRUd)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember cRUd
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf cRUd
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal cRUd
             ]
          ]
      , "3. Assign an employee (cRuD)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember cRuD
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf cRuD
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal cRuD
             ]
          ]
      , "4. Assign an employee (cRUD)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember cRUD
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf cRUD
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal cRUD
             ]
          ]
      , "5. Assign an employee (CRud)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember CRud
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf CRud
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal CRud
             ]
          ]
      , "6. Assign an employee (CRUd)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember CRUd
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf CRUd
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal CRUd
             ]
          ]
      , "7. Assign an employee (CRuD)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember CRuD
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf CRuD
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal CRuD
             ]
          ]
      , "8. Assign an employee (CRUD)" : I[Project] cRud BOX<TABLE noHeader>
          [ Naam : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : eligible
             , "setRelation"  : projectMember CRUD
             ]
          , Instroom : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : instroomOpties
             , "setRelation"  : instroomVanaf CRUD
             ]
          , Aantal : I[Project] cRud BOX<FILTEREDDROPDOWN>
             [ "selectFrom"   : keuze
             , "setRelation"  : aantal CRUD
             ]
          ]
      ]

  , "Project Master (UNI)" : V[SESSION*Project] cRud BOX<FORM>
      [ "Project ID" : I cRud
      , setRelationPreview : projectMaster cRud  
      , selectFromPreview : eligible cRud  

      , "1. Project Master (cRud)" : I[Project] cRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster cRud
          , selectFrom : eligible
          ]
      , "2. Project Master (cRud)" : I[Project] cRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster cRUd
          , selectFrom : eligible
          ]
      , "3. Project Master (cRuD)" : I[Project] cRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster cRuD
          , selectFrom : eligible
          ]
      , "4. Project Master (cRuD)" : I[Project] cRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster cRUD
          , selectFrom : eligible
          ]
      , "5. Project Master (CRud)" : I[Project] CRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster CRud
          , selectFrom : eligible
          ]
      , "6. Project Master (CRud)" : I[Project] CRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster CRUd
          , selectFrom : eligible
          ]
      , "7. Project Master (CRuD)" : I[Project] CRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster CRuD
          , selectFrom : eligible
          ]
      , "8. Project Master (CRuD)" : I[Project] CRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectMaster CRUD
          , selectFrom : eligible
          ]
      ]

  , "Project Founder (TOT)" : V[SESSION*Project] cRud BOX<FORM>
      [ "Project ID" : I cRud
      , setRelationPreview : projectFounder cRud 
      , selectFromPreview : eligible cRud  

      , "1. Project Founder (cRud)" : I[Project] cRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder cRud
          , selectFrom : eligible
          ]
      , "2. Project Founder (cRud)" : I[Project] cRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder cRUd
          , selectFrom : eligible
          ]
      , "3. Project Founder (cRuD)" : I[Project] cRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder cRuD
          , selectFrom : eligible
          ]
      , "4. Project Founder (cRuD)" : I[Project] cRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder cRUD
          , selectFrom : eligible
          ]
      , "5. Project Founder (CRud)" : I[Project] CRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder CRud
          , selectFrom : eligible
          ]
      , "6. Project Founder (CRud)" : I[Project] CRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder CRUd
          , selectFrom : eligible
          ]
      , "7. Project Founder (CRuD)" : I[Project] CRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder CRuD
          , selectFrom : eligible
          ]
      , "8. Project Founder (CRuD)" : I[Project] CRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectFounder CRUD
          , selectFrom : eligible
          ]
      ]

  , "Project Responsible (UNI TOT)" : V[SESSION*Project] cRud BOX<FORM>
      [ "Project ID" : I cRud
      , setRelationPreview : projectResponsible cRud  
      , selectFromPreview : eligible cRud  

      , "1. Responsible (cRud)" : I[Project] cRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible cRud
          , selectFrom : eligible
          ]
      , "2. Responsible (cRud)" : I[Project] cRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible cRUd
          , selectFrom : eligible
          ]
      , "3. Responsible (cRuD)" : I[Project] cRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible cRuD
          , selectFrom : eligible
          ]
      , "4. Responsible (cRuD)" : I[Project] cRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible cRUD
          , selectFrom : eligible
          ]
      , "5. Responsible (CRud)" : I[Project] CRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible CRud
          , selectFrom : eligible
          ]
      , "6. Responsible (CRud)" : I[Project] CRud BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible CRUd
          , selectFrom : eligible
          ]
      , "7. Responsible (CRuD)" : I[Project] CRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible CRuD
          , selectFrom : eligible
          ]
      , "8. Responsible (CRuD)" : I[Project] CRuD BOX<FILTEREDDROPDOWN>
          [ setRelation : projectResponsible CRUD
          , selectFrom : eligible
          ]
      ]
  ]

-- uncomment an item to see the errors appearing in red notification and in console
INTERFACE BoxFilteredDropdownErrors LABEL "Box-Filtered-Dropdown-errors" : "_SESSION"[SESSION] cRud BOX<TABS>
  [ "Section Header Errors" : TXT "This section creates errors as red notification and in console. These errors are expected."
  , "Default": V[SESSION*Project] cRud BOX<FORM>
      [ "Project ID" : I cRud
      , "setRelation(ProjectMember)Preview" : projectMember cRud  
      , "setRelation(ProjectLocation)Preview" : projectLocation cRud  
      , selectFromPreview : eligible cRud     

    --   , "1. Assign an employee (crud/crud)" : I crud BOX<FILTEREDDROPDOWN> -- box not readable
    --       [ setRelation : projectLocation crud
    --       , selectFrom : eligible
    --       ]
    --   , "2. Assign an employee (crud/cRud)" : I crud BOX<FILTEREDDROPDOWN> -- box not readable
    --       [ setRelation : projectMember cRud
    --       , selectFrom : eligible
    --       ]
    --   , "3. Assign an employee (cRud/crud)" : I cRud BOX<FILTEREDDROPDOWN> -- relation not readable
    --       [ setRelation : projectMember crud
    --       , selectFrom : eligible
    --       ]
    --   , "4. Assign an employee (cRud)" : I BOX<FILTEREDDROPDOWN> -- relation and selectFrom of different type
    --       [ "setRelation"   : projectLocation cRud
    --       , "selectFrom"  : eligible
    --       ]
    --   , "5. Assign an employee (cRud)" : I BOX<FILTEREDDROPDOWN> -- relation and selectFrom of different type, swapped
    --       [ "setRelation"   : eligible cRud
    --       , "selectFrom"  : projectLocation 
    --       ]
      ]
  ]

ENDCONTEXT
